
package com.idnowreactlibrary;

import android.content.Context;
import android.util.Log;
import android.widget.Toast;

import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;
import com.facebook.react.bridge.ReactMethod;

import de.idnow.core.IDnowConfig;
import de.idnow.core.IDnowResult;
import de.idnow.core.IDnowSDK;


public class RNIdnowLibraryModule extends ReactContextBaseJavaModule implements IDnowSDK.IDnowResultListener  {

  private IDnowSDK idnowSdk;
  private final ReactApplicationContext reactContext;

  public RNIdnowLibraryModule(ReactApplicationContext reactContext) {
    super(reactContext);
    this.reactContext = reactContext;
  }

  @ReactMethod
  public void startIdent(String text) {
    Context context = getReactApplicationContext();
    IDnowConfig idnowConfig = IDnowConfig.Builder.getInstance()
            .withLanguage("en") // this line is not necessary, please see below
            .build();

    idnowSdk = IDnowSDK.getInstance();
    idnowSdk.initialize(getCurrentActivity(), idnowConfig);
    String identId = text.toUpperCase();
    idnowSdk.startIdent(identId, this);
  }

  @Override
  public String getName() {
    return "RNIdnowLibrary";
  }

  @Override
  public void onIdentResult(IDnowResult iDnowResult) {
    if (iDnowResult.getIDnowStatusCode() == IDnowResult.IDnowStatusCode.FINISHED) {
      Log.d("", "Finished");
    } else if (iDnowResult.getIDnowStatusCode() == IDnowResult.IDnowStatusCode.CANCELLED) {
      Log.d("", "Cancelled");
    } else if (iDnowResult.getIDnowStatusCode() == IDnowResult.IDnowStatusCode.ERROR) {
      Log.d("", "Error: " + iDnowResult.getMessage());
      Toast.makeText(getReactApplicationContext(), "error: " + iDnowResult.getMessage(), Toast.LENGTH_SHORT).show();
    }
  }
}